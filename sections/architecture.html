

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Architecture Overview &mdash; sh 1.14.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/gitads.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API" href="command_class.html" />
    <link rel="prev" title="Special Kwargs" href="special_arguments.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> sh
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="passing_arguments.html">Passing Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="passing_arguments.html#keyword-arguments">Keyword Arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="exit_codes.html">Exit Codes &amp; Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="exit_codes.html#signals">Signals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="redirection.html">Redirection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="redirection.html#filename">Filename</a></li>
<li class="toctree-l3"><a class="reference internal" href="redirection.html#file-like-object">File-like Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="redirection.html#function-callback">Function Callback</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="asynchronous_execution.html">Asynchronous Execution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="asynchronous_execution.html#incremental-iteration">Incremental Iteration</a></li>
<li class="toctree-l3"><a class="reference internal" href="asynchronous_execution.html#background-processes">Background Processes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="asynchronous_execution.html#output-callbacks">Output Callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous_execution.html#interactive-callbacks">Interactive callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="asynchronous_execution.html#done-callbacks">Done Callbacks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="baking.html">Baking</a></li>
<li class="toctree-l2"><a class="reference internal" href="piping.html">Piping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="piping.html#basic">Basic</a></li>
<li class="toctree-l3"><a class="reference internal" href="piping.html#advanced">Advanced</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="subcommands.html">Sub-commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="default_arguments.html">Default Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="envs.html">Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="stdin.html">Input via STDIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="with.html">‘With’ Contexts</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../reference.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="special_arguments.html">Special Kwargs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#controlling-output">Controlling Output</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#out">_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#err">_err</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#err-to-out">_err_to_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#encoding">_encoding</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#decode-errors">_decode_errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#tee">_tee</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#truncate-exc">_truncate_exc</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#execution">Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#fg">_fg</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#bg">_bg</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#bg-exc">_bg_exc</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#env">_env</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#timeout">_timeout</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#timeout-signal">_timeout_signal</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#cwd">_cwd</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#ok-code">_ok_code</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#new-session">_new_session</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#uid">_uid</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#preexec-fn">_preexec_fn</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#pass-fds">_pass_fds</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#close-fds">_close_fds</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#communication">Communication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#in">_in</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#piped">_piped</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#iter">_iter</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#iter-noblock">_iter_noblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#with">_with</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#done">_done</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#ttys">TTYs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#tty-in">_tty_in</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#tty-out">_tty_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#unify-ttys">_unify_ttys</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#tty-size">_tty_size</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#performance-optimization">Performance &amp; Optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#in-bufsize">_in_bufsize</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#out-bufsize">_out_bufsize</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#err-bufsize">_err_bufsize</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#internal-bufsize">_internal_bufsize</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#no-out">_no_out</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#no-err">_no_err</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#no-pipe">_no_pipe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#program-arguments">Program Arguments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#long-sep">_long_sep</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#long-prefix">_long_prefix</a></li>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#arg-preprocess">_arg_preprocess</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="special_arguments.html#misc">Misc</a><ul>
<li class="toctree-l4"><a class="reference internal" href="special_arguments.html#log-msg">_log_msg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Architecture Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#launch">Launch</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#child">Child</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parent">Parent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running">Running</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#buffers">Buffers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exit">Exit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stdin-thread-shutdown">STDIN Thread Shutdown</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stdout-err-thread-shutdown">STDOUT/ERR Thread Shutdown</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exit-code-processing">Exit Code Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#done-callback">Done Callback</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_class.html">API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_class.html#command-class">Command Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_class.html#runningcommand-class">RunningCommand Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_class.html#oproc-class">OProc Class</a></li>
<li class="toctree-l3"><a class="reference internal" href="command_class.html#exceptions">Exceptions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="command_class.html#errorreturncode">ErrorReturnCode</a></li>
<li class="toctree-l4"><a class="reference internal" href="command_class.html#signalexception">SignalException</a></li>
<li class="toctree-l4"><a class="reference internal" href="command_class.html#timeoutexception">TimeoutException</a></li>
<li class="toctree-l4"><a class="reference internal" href="command_class.html#commandnotfound">CommandNotFound</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="command_class.html#helper-functions">Helper Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contrib Commands</a><ul>
<li class="toctree-l2"><a class="reference internal" href="contrib.html#commands">Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contrib.html#sudo">Sudo</a></li>
<li class="toctree-l3"><a class="reference internal" href="contrib.html#git">Git</a></li>
<li class="toctree-l3"><a class="reference internal" href="contrib.html#ssh">SSH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contrib.html#extending">Extending</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sudo.html">Using Sudo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sudo.html#sh-contrib-sudo">sh.contrib.sudo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sudo.html#terminal-input">Terminal Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="sudo.html#string-input">String Input</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sudo.html#etc-sudoers-nopasswd">/etc/sudoers NOPASSWD</a></li>
<li class="toctree-l2"><a class="reference internal" href="sudo.html#sh-sudo">sh.sudo</a></li>
<li class="toctree-l2"><a class="reference internal" href="sudo.html#fg-true">_fg=True</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/real_time_output.html">Tailing a real-time log file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/interacting_with_processes.html">Entering an SSH password</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/interacting_with_processes.html#ssh-contrib-command">SSH Contrib command</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/interacting_with_processes.html#how-you-should-really-be-using-ssh">How you should REALLY be using SSH</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-execute-a-bash-builtin">How do I execute a bash builtin?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#will-windows-be-supported">Will Windows be supported?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-append-output-to-a-file">How do I append output to a file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-does-my-command-s-output-have-color">Why does my command’s output have color?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-is-tty-out-true-the-default">Why is _tty_out=True the default?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-doesn-t-work-as-a-command-argument">Why doesn’t “*” work as a command argument?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-call-a-program-that-isn-t-in-path">How do I call a program that isn’t in <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-execute-a-program-with-a-dash-in-its-name">How do I execute a program with a dash in its name?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-execute-a-program-with-a-special-character-in-its-name">How do I execute a program with a special character in its name?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-not-use-to-pipe-commands">Why not use <code class="docutils literal notranslate"><span class="pre">|</span></code> to pipe commands?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-isn-t-piping-asynchronous-by-default">Why isn’t piping asynchronous by default?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-run-a-command-and-connect-it-to-sys-stdout-and-sys-stdin">How do I run a command and connect it to sys.stdout and sys.stdin?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-do-my-arguments-need-to-be-separate-strings">Why do my arguments need to be separate strings?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-order-keyword-arguments">How do I order keyword arguments?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-to-disable-pylint-e1101-no-member-errors">How to disable pylint E1101 no-member errors?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-patch-sh-in-my-tests">How do I patch sh in my tests?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#why-is-sh-just-a-single-file">Why is sh just a single file?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-do-i-see-the-commands-sh-is-running">How do I see the commands sh is running?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sh</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../reference.html">Reference</a> &raquo;</li>
        
      <li>Architecture Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/sections/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="architecture-overview">
<span id="architecture"></span><h1>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="launch">
<h2>Launch<a class="headerlink" href="#launch" title="Permalink to this headline">¶</a></h2>
<p>When it comes time to launch a process</p>
<ol class="arabic simple">
<li>Open pipes and/or TTYs STDIN/OUT/ERR.</li>
<li>Open a pipe for communicating pre-exec exceptions from the child to the
parent.</li>
<li>Open a pipe for child/parent launch synchronization.</li>
<li><a class="reference external" href="https://docs.python.org/3.5/library/os.html#os.fork" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.fork()</span></code></a> a child process.</li>
</ol>
<p>From here, we have two concurrent processes running:</p>
<div class="section" id="child">
<h3>Child<a class="headerlink" href="#child" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>If <a class="reference internal" href="special_arguments.html#bg"><span class="std std-ref">_bg=True</span></a> is set, we ignore <code class="xref py py-attr docutils literal notranslate"><span class="pre">signal.SIGHUP</span></code>.</li>
<li>If <a class="reference internal" href="special_arguments.html#new-session"><span class="std std-ref">_new_session=True</span></a>, become a session leader with
<a class="reference external" href="https://docs.python.org/3.5/library/os.html#os.setsid" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.setsid()</span></code></a>, else become a process group leader with
<a class="reference external" href="https://docs.python.org/3.5/library/os.html#os.setpgrp" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.setpgrp()</span></code></a>.</li>
<li>Write our session id to the a pipe connected to the parent.  This is mainly
to synchronize with our parent that our session/group logic has finished.</li>
<li><a class="reference external" href="https://docs.python.org/3.5/library/os.html#os.dup2" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.dup2()</span></code></a> the file descriptors of our previously-setup TTYs/pipes to
our STDIN/OUT/ERR file descriptors.</li>
<li>If we’re a session leader and our STDIN is a TTY, via <a class="reference internal" href="special_arguments.html#tty-in"><span class="std std-ref">_tty_in=True</span></a>, acquire a controlling
terminal, thereby becoming the controlling process of the session.</li>
<li>Set our GID/UID if we’ve set a custom one via <a class="reference internal" href="special_arguments.html#uid"><span class="std std-ref">_uid</span></a>.</li>
<li>Close all file descriptors greater than STDERR.</li>
<li>Call <a class="reference external" href="https://docs.python.org/3.5/library/os.html#os.execv" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.execv()</span></code></a>.</li>
</ol>
</div>
<div class="section" id="parent">
<h3>Parent<a class="headerlink" href="#parent" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Check for any exceptions via the exception pipe connected to the child.</li>
<li>Block and read our child’s session id from a pipe connected to the child.
This synchronizes to us that the child has finished moving between
sessions/groups and we can now accurately determine its current session id
and process group.</li>
<li>If we’re using a TTY for STDIN, via <a class="reference internal" href="special_arguments.html#tty-in"><span class="std std-ref">_tty_in=True</span></a>, disable
echoing on the TTY, so that data sent to STDIN is not echoed to STDOUT.</li>
</ol>
</div>
</div>
<div class="section" id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>An instance of <a class="reference internal" href="command_class.html#oproc-class"><span class="std std-ref">OProc Class</span></a> contains two internal threads, one for STDIN,
and one for STDOUT and STDERR.  The purpose of these threads is to handle
reading/writing to the read/write ends of the process’s standard descriptors.</p>
<p>For example, the STDOUT/ERR thread continually runs <a class="reference external" href="https://docs.python.org/3.5/library/select.html#select.select" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">select.select()</span></code></a> on the
master ends of the TTYs/pipes connected to STDOUT/ERR, and if they’re ready to
read, reads the available data and aggregates it into the appropriate place.</p>
<div class="section" id="buffers">
<span id="arch-buffers"></span><h3>Buffers<a class="headerlink" href="#buffers" title="Permalink to this headline">¶</a></h3>
<p>A couple of different buffers must be considered when thinking about how data
flows through an sh process.</p>
<p>The first buffer is the buffer associated with the underlying pipe or TTY
attached to STDOUT/ERR.  In the case of a TTY (the default for output), the
buffer size is 0, so output is immediate – a byte written by the process is a
byte received by sh.  For a pipe, however, the buffer size of the pipe is
typically 4-64kb.  <em class="manpage">pipe(2)</em>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">FAQ: <a class="reference internal" href="faq.html#faq-tty-out"><span class="std std-ref">Why is _tty_out=True the default?</span></a></p>
</div>
<p>The second buffer is sh’s internal buffers, one for STDOUT and one for STDERR.
These buffers aggregate data that has been read from the master end of the TTY
or pipe attached to the output fd, but before that data is sent along to the
appropriate output handler (queue, file object, function, etc).  Data sits in
these buffers until we reach the size specified with <a class="reference internal" href="special_arguments.html#internal-bufsize"><span class="std std-ref">_internal_bufsize</span></a>, at
which point the buffer flushes to the output handler.</p>
</div>
</div>
<div class="section" id="exit">
<h2>Exit<a class="headerlink" href="#exit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="stdin-thread-shutdown">
<h3>STDIN Thread Shutdown<a class="headerlink" href="#stdin-thread-shutdown" title="Permalink to this headline">¶</a></h3>
<p>On process completion, our internal threads must complete, as the read end of
STDIN, for example, which is connected to the process, is no longer open, so
writing to the slave end will no longer work.</p>
</div>
<div class="section" id="stdout-err-thread-shutdown">
<h3>STDOUT/ERR Thread Shutdown<a class="headerlink" href="#stdout-err-thread-shutdown" title="Permalink to this headline">¶</a></h3>
<p>The STDOUT/ERR thread is a little more complicated, because although the process
is not alive, output data may still exist in the pipe/TTY buffer that must be
collected.  So we essentially just <a class="reference external" href="https://docs.python.org/3.5/library/select.html#select.select" title="(in Python v3.5)"><code class="xref py py-func docutils literal notranslate"><span class="pre">select.select()</span></code></a> on the read ends until
they return nothing, indicating that they are complete, then we break out of our
read loop.</p>
</div>
<div class="section" id="exit-code-processing">
<span id="arch-exit-code"></span><h3>Exit Code Processing<a class="headerlink" href="#exit-code-processing" title="Permalink to this headline">¶</a></h3>
<p>The exit code is obtained from the reaped process.  If the process ended from a
signal, the exit code is the negative value of that signal.  For example,
SIGKILL would result in an exit code -9.</p>
</div>
<div class="section" id="done-callback">
<h3>Done Callback<a class="headerlink" href="#done-callback" title="Permalink to this headline">¶</a></h3>
<p>If specified, the <a class="reference internal" href="special_arguments.html#done"><span class="std std-ref">_done</span></a> callback is executed with the <a class="reference internal" href="command_class.html#running-command"><span class="std std-ref">RunningCommand</span></a> instance, a boolean indicating success, and the adjusted exit
code.  After the callback returns, error processing continues.  In other words,
the done callback is called regardless of success or failure, and there’s
nothing it can do to prevent the <a class="reference internal" href="command_class.html#error-return-code"><span class="std std-ref">ErrorReturnCode</span></a>
exceptions from being raised after it completes.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="command_class.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="special_arguments.html" class="btn btn-neutral float-left" title="Special Kwargs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Andrew Moffat

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>